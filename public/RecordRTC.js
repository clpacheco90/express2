'use strict';function RecordRTC(mediaStream,config){if(!mediaStream){throw'MediaStream is mandatory.'}config=config||{type:'video'};config=new RecordRTCConfiguration(mediaStream,config);var self=this;function startRecording(){if(!config.disableLogs){console.debug('started recording '+config.type+' stream.')}if(mediaRecorder){mediaRecorder.clearRecordedData();mediaRecorder.resume();if(self.recordingDuration){handleRecordingDuration()}return self}initRecorder(function(){if(self.recordingDuration){handleRecordingDuration()}});return self}function initRecorder(initCallback){if(initCallback){config.initCallback=function(){initCallback();initCallback=config.initCallback=null}}var Recorder=new GetRecorderType(mediaStream,config);mediaRecorder=new Recorder(mediaStream,config);mediaRecorder.record();if(!config.disableLogs){console.debug('Initialized recorderType:',mediaRecorder.constructor.name,'for output-type:',config.type)}}function stopRecording(callback){if(!mediaRecorder){return console.warn(WARNING)}var recordRTC=this;if(!config.disableLogs){console.warn('Stopped recording '+config.type+' stream.')}if(config.type!=='gif'){mediaRecorder.stop(_callback)}else{mediaRecorder.stop();_callback()}function _callback(){for(var item in mediaRecorder){if(self){self[item]=mediaRecorder[item]}if(recordRTC){recordRTC[item]=mediaRecorder[item]}}var blob=mediaRecorder.blob;if(callback){var url=URL.createObjectURL(blob);callback(url)}if(blob&&!config.disableLogs){console.debug(blob.type,'->',bytesToSize(blob.size))}if(!config.autoWriteToDisk){return}getDataURL(function(dataURL){var parameter={};parameter[config.type+'Blob']=dataURL;DiskStorage.Store(parameter)})}}function pauseRecording(){if(!mediaRecorder){return console.warn(WARNING)}mediaRecorder.pause();if(!config.disableLogs){console.debug('Paused recording.')}}function resumeRecording(){if(!mediaRecorder){return console.warn(WARNING)}mediaRecorder.resume();if(!config.disableLogs){console.debug('Resumed recording.')}}function readFile(_blob){postMessage(new FileReaderSync().readAsDataURL(_blob))}function getDataURL(callback,_mediaRecorder){if(!callback){throw'Pass a callback function over getDataURL.'}var blob=_mediaRecorder?_mediaRecorder.blob:(mediaRecorder||{}).blob;if(!blob){if(!config.disableLogs){console.warn('Blob encoder did not yet finished its job.')}setTimeout(function(){getDataURL(callback,_mediaRecorder)},1000);return}if(typeof Worker!=='undefined'&&!navigator.mozGetUserMedia){var webWorker=processInWebWorker(readFile);webWorker.onmessage=function(event){callback(event.data)};webWorker.postMessage(blob)}else{var reader=new FileReader();reader.readAsDataURL(blob);reader.onload=function(event){callback(event.target.result)}}function processInWebWorker(_function){var blob=URL.createObjectURL(new Blob([_function.toString(),'this.onmessage =  function (e) {'+_function.name+'(e.data);}'],{type:'application/javascript'}));var worker=new Worker(blob);URL.revokeObjectURL(blob);return worker}}function handleRecordingDuration(){setTimeout(function(){stopRecording(self.onRecordingStopped)},self.recordingDuration)}var WARNING='It seems that "startRecording" is not invoked for '+config.type+' recorder.';var mediaRecorder;var returnObject={startRecording:startRecording,stopRecording:stopRecording,pauseRecording:pauseRecording,resumeRecording:resumeRecording,initRecorder:initRecorder,setRecordingDuration:function(milliseconds,callback){if(typeof milliseconds==='undefined'){throw'milliseconds is required.'}if(typeof milliseconds!=='number'){throw'milliseconds must be a number.'}self.recordingDuration=milliseconds;self.onRecordingStopped=callback||function(){};return{onRecordingStopped:function(callback){self.onRecordingStopped=callback}}},clearRecordedData:function(){if(!mediaRecorder){return console.warn(WARNING)}mediaRecorder.clearRecordedData();if(!config.disableLogs){console.debug('Cleared old recorded data.')}},getBlob:function(){if(!mediaRecorder){return console.warn(WARNING)}return mediaRecorder.blob},getDataURL:getDataURL,toURL:function(){if(!mediaRecorder){return console.warn(WARNING)}return URL.createObjectURL(mediaRecorder.blob)},save:function(fileName){if(!mediaRecorder){return console.warn(WARNING)}invokeSaveAsDialog(mediaRecorder.blob,fileName)},getFromDisk:function(callback){if(!mediaRecorder){return console.warn(WARNING)}RecordRTC.getFromDisk(config.type,callback)},setAdvertisementArray:function(arrayOfWebPImages){config.advertisement=[];var length=arrayOfWebPImages.length;for(var i=0;i<length;i++){config.advertisement.push({duration:i,image:arrayOfWebPImages[i]})}},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null};if(!this){self=returnObject;return returnObject}for(var prop in returnObject){this[prop]=returnObject[prop]}self=this;return returnObject}RecordRTC.getFromDisk=function(type,callback){if(!callback){throw'callback is mandatory.'}console.log('Getting recorded '+(type==='all'?'blobs':type+' blob ')+' from disk!');DiskStorage.Fetch(function(dataURL,_type){if(type!=='all'&&_type===type+'Blob'&&callback){callback(dataURL)}if(type==='all'&&callback){callback(dataURL,_type.replace('Blob',''))}})};RecordRTC.writeToDisk=function(options){console.log('Writing recorded blob(s) to disk!');options=options||{};if(options.audio&&options.video&&options.gif){options.audio.getDataURL(function(audioDataURL){options.video.getDataURL(function(videoDataURL){options.gif.getDataURL(function(gifDataURL){DiskStorage.Store({audioBlob:audioDataURL,videoBlob:videoDataURL,gifBlob:gifDataURL})})})})}else if(options.audio&&options.video){options.audio.getDataURL(function(audioDataURL){options.video.getDataURL(function(videoDataURL){DiskStorage.Store({audioBlob:audioDataURL,videoBlob:videoDataURL})})})}else if(options.audio&&options.gif){options.audio.getDataURL(function(audioDataURL){options.gif.getDataURL(function(gifDataURL){DiskStorage.Store({audioBlob:audioDataURL,gifBlob:gifDataURL})})})}else if(options.video&&options.gif){options.video.getDataURL(function(videoDataURL){options.gif.getDataURL(function(gifDataURL){DiskStorage.Store({videoBlob:videoDataURL,gifBlob:gifDataURL})})})}else if(options.audio){options.audio.getDataURL(function(audioDataURL){DiskStorage.Store({audioBlob:audioDataURL})})}else if(options.video){options.video.getDataURL(function(videoDataURL){DiskStorage.Store({videoBlob:videoDataURL})})}else if(options.gif){options.gif.getDataURL(function(gifDataURL){DiskStorage.Store({gifBlob:gifDataURL})})}};if(typeof module!=='undefined'){module.exports=RecordRTC}if(typeof define==='function'&&define.amd){define('RecordRTC',[],function(){return RecordRTC})}function RecordRTCConfiguration(mediaStream,config){if(config.recorderType&&!config.type){if(config.recorderType===WhammyRecorder||config.recorderType===CanvasRecorder){config.type='video'}else if(config.recorderType===GifRecorder){config.type='gif'}else if(config.recorderType===StereoAudioRecorder){config.type='audio'}else if(config.recorderType===MediaStreamRecorder){if(mediaStream.getAudioTracks().length&&mediaStream.getVideoTracks().length){config.type='video'}else if(mediaStream.getAudioTracks().length&&!mediaStream.getVideoTracks().length){config.type='audio'}else if(!mediaStream.getAudioTracks().length&&mediaStream.getVideoTracks().length){config.type='audio'}else{}}}if(typeof MediaStreamRecorder!=='undefined'&&typeof MediaRecorder!=='undefined'&&'requestData'in MediaRecorder.prototype){if(!config.mimeType){config.mimeType='video/webm'}if(!config.type){config.type=config.mimeType.split('/')[0]}if(!config.bitsPerSecond){}}if(!config.type){if(config.mimeType){config.type=config.mimeType.split('/')[0]}if(!config.type){config.type='audio'}}return config}function GetRecorderType(mediaStream,config){var recorder;if(isChrome||isEdge||isOpera){recorder=StereoAudioRecorder}if(typeof MediaRecorder!=='undefined'&&'requestData'in MediaRecorder.prototype&&!isChrome){recorder=MediaStreamRecorder}if(config.type==='video'&&(isChrome||isOpera)){recorder=WhammyRecorder}if(config.type==='gif'){recorder=GifRecorder}if(config.type==='canvas'){recorder=CanvasRecorder}if(isMediaRecorderCompatible()&&recorder!==CanvasRecorder&&recorder!==GifRecorder&&typeof MediaRecorder!=='undefined'&&'requestData'in MediaRecorder.prototype){if(mediaStream.getVideoTracks().length){recorder=MediaStreamRecorder}}if(config.recorderType){recorder=config.recorderType}if(!config.disableLogs&&!!recorder&&!!recorder.name){console.debug('Using recorderType:',recorder.name||recorder.constructor.name)}return recorder}function MRecordRTC(mediaStream){this.addStream=function(_mediaStream){if(_mediaStream){mediaStream=_mediaStream}};this.mediaType={audio:true,video:true};this.startRecording=function(){var mediaType=this.mediaType;var recorderType;var mimeType=this.mimeType||{audio:null,video:null,gif:null};if(typeof mediaType.audio!=='function'&&isMediaRecorderCompatible()&&mediaStream.getAudioTracks&&!mediaStream.getAudioTracks().length){mediaType.audio=false}if(typeof mediaType.video!=='function'&&isMediaRecorderCompatible()&&mediaStream.getVideoTracks&&!mediaStream.getVideoTracks().length){mediaType.video=false}if(!mediaType.audio&&!mediaType.video){throw'MediaStream must have either audio or video tracks.'}if(!!mediaType.audio){recorderType=null;if(typeof mediaType.audio==='function'){recorderType=mediaType.audio}this.audioRecorder=new RecordRTC(mediaStream,{type:'audio',bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:recorderType,mimeType:mimeType.audio});if(!mediaType.video){this.audioRecorder.startRecording()}}if(!!mediaType.video){recorderType=null;if(typeof mediaType.video==='function'){recorderType=mediaType.video}var newStream=mediaStream;if(isMediaRecorderCompatible()&&!!mediaType.audio&&typeof mediaType.audio==='function'){var videoTrack=mediaStream.getVideoTracks()[0];if(!!navigator.mozGetUserMedia){newStream=new MediaStream();newStream.addTrack(videoTrack);if(recorderType&&recorderType===WhammyRecorder){recorderType=MediaStreamRecorder}}else{newStream=new MediaStream([videoTrack])}}this.videoRecorder=new RecordRTC(newStream,{type:'video',video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:recorderType,mimeType:mimeType.video});if(!mediaType.audio){this.videoRecorder.startRecording()}}if(!!mediaType.audio&&!!mediaType.video){var self=this;if(isMediaRecorderCompatible()){self.audioRecorder=null;self.videoRecorder.startRecording()}else{self.videoRecorder.initRecorder(function(){self.audioRecorder.initRecorder(function(){self.videoRecorder.startRecording();self.audioRecorder.startRecording()})})}}if(!!mediaType.gif){recorderType=null;if(typeof mediaType.gif==='function'){recorderType=mediaType.gif}this.gifRecorder=new RecordRTC(mediaStream,{type:'gif',frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:recorderType,mimeType:mimeType.gif});this.gifRecorder.startRecording()}};this.stopRecording=function(callback){callback=callback||function(){};if(this.audioRecorder){this.audioRecorder.stopRecording(function(blobURL){callback(blobURL,'audio')})}if(this.videoRecorder){this.videoRecorder.stopRecording(function(blobURL){callback(blobURL,'video')})}if(this.gifRecorder){this.gifRecorder.stopRecording(function(blobURL){callback(blobURL,'gif')})}};this.getBlob=function(callback){var output={};if(this.audioRecorder){output.audio=this.audioRecorder.getBlob()}if(this.videoRecorder){output.video=this.videoRecorder.getBlob()}if(this.gifRecorder){output.gif=this.gifRecorder.getBlob()}if(callback){callback(output)}return output};this.getDataURL=function(callback){this.getBlob(function(blob){getDataURL(blob.audio,function(_audioDataURL){getDataURL(blob.video,function(_videoDataURL){callback({audio:_audioDataURL,video:_videoDataURL})})})});function getDataURL(blob,callback00){if(typeof Worker!=='undefined'){var webWorker=processInWebWorker(function readFile(_blob){postMessage(new FileReaderSync().readAsDataURL(_blob))});webWorker.onmessage=function(event){callback00(event.data)};webWorker.postMessage(blob)}else{var reader=new FileReader();reader.readAsDataURL(blob);reader.onload=function(event){callback00(event.target.result)}}}function processInWebWorker(_function){var blob=URL.createObjectURL(new Blob([_function.toString(),'this.onmessage =  function (e) {'+_function.name+'(e.data);}'],{type:'application/javascript'}));var worker=new Worker(blob);var url;if(typeof URL!=='undefined'){url=URL}else if(typeof webkitURL!=='undefined'){url=webkitURL}else{throw'Neither URL nor webkitURL detected.'}url.revokeObjectURL(blob);return worker}};this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})};this.save=function(args){args=args||{audio:true,video:true,gif:true};if(!!args.audio&&this.audioRecorder){this.audioRecorder.save(typeof args.audio==='string'?args.audio:'')}if(!!args.video&&this.videoRecorder){this.videoRecorder.save(typeof args.video==='string'?args.video:'')}if(!!args.gif&&this.gifRecorder){this.gifRecorder.save(typeof args.gif==='string'?args.gif:'')}}}MRecordRTC.getFromDisk=RecordRTC.getFromDisk;MRecordRTC.writeToDisk=RecordRTC.writeToDisk;if(typeof RecordRTC!=='undefined'){RecordRTC.MRecordRTC=MRecordRTC}var browserFakeUserAgent='Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45';(function(that){if(!that){return}if(typeof window!=='undefined'){return}if(typeof global==='undefined'){return}global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}};if(!global.console){global.console={}}if(typeof global.console.debug==='undefined'){global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}}if(typeof document==='undefined'){that.document={};document.createElement=document.captureStream=document.mozCaptureStream=function(){var obj={getContext:function(){return obj},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return''}};return obj};that.HTMLVideoElement=function(){}}if(typeof location==='undefined'){that.location={protocol:'file:',href:'',hash:''}}if(typeof screen==='undefined'){that.screen={width:0,height:0}}if(typeof URL==='undefined'){that.URL={createObjectURL:function(){return''},revokeObjectURL:function(){return''}}}that.window=global})(typeof global!=='undefined'?global:null);var requestAnimationFrame=window.requestAnimationFrame;if(typeof requestAnimationFrame==='undefined'){if(typeof webkitRequestAnimationFrame!=='undefined'){requestAnimationFrame=webkitRequestAnimationFrame}if(typeof mozRequestAnimationFrame!=='undefined'){requestAnimationFrame=mozRequestAnimationFrame}}var cancelAnimationFrame=window.cancelAnimationFrame;if(typeof cancelAnimationFrame==='undefined'){if(typeof webkitCancelAnimationFrame!=='undefined'){cancelAnimationFrame=webkitCancelAnimationFrame}if(typeof mozCancelAnimationFrame!=='undefined'){cancelAnimationFrame=mozCancelAnimationFrame}}var AudioContext=window.AudioContext;if(typeof AudioContext==='undefined'){if(typeof webkitAudioContext!=='undefined'){AudioContext=webkitAudioContext}if(typeof mozAudioContext!=='undefined'){AudioContext=mozAudioContext}}var URL=window.URL;if(typeof URL==='undefined'&&typeof webkitURL!=='undefined'){URL=webkitURL}if(typeof navigator!=='undefined'){if(typeof navigator.webkitGetUserMedia!=='undefined'){navigator.getUserMedia=navigator.webkitGetUserMedia}if(typeof navigator.mozGetUserMedia!=='undefined'){navigator.getUserMedia=navigator.mozGetUserMedia}}var isEdge=navigator.userAgent.indexOf('Edge')!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob);var isOpera=!!window.opera||navigator.userAgent.indexOf('OPR/')!==-1;var isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia;var MediaStream=window.MediaStream;if(typeof MediaStream==='undefined'&&typeof webkitMediaStream!=='undefined'){MediaStream=webkitMediaStream}if(typeof MediaStream!=='undefined'){if(!('getVideoTracks'in MediaStream.prototype)){MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks){return[]}var tracks=[];this.getTracks.forEach(function(track){if(track.kind.toString().indexOf('video')!==-1){tracks.push(track)}});return tracks};MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks){return[]}var tracks=[];this.getTracks.forEach(function(track){if(track.kind.toString().indexOf('audio')!==-1){tracks.push(track)}});return tracks}}if(!('stop'in MediaStream.prototype)){MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(track){if(!!track.stop){track.stop()}});this.getVideoTracks().forEach(function(track){if(!!track.stop){track.stop()}})}}}function bytesToSize(bytes){var k=1000;var sizes=['Bytes','KB','MB','GB','TB'];if(bytes===0){return'0 Bytes'}var i=parseInt(Math.floor(Math.log(bytes)/Math.log(k)),10);return(bytes/Math.pow(k,i)).toPrecision(3)+' '+sizes[i]}function invokeSaveAsDialog(file,fileName){if(!file){throw'Blob object is required.'}if(!file.type){try{file.type='video/webm'}catch(e){}}var fileExtension=(file.type||'video/webm').split('/')[1];if(fileName&&fileName.indexOf('.')!==-1){var splitted=fileName.split('.');fileName=splitted[0];fileExtension=splitted[1]}var fileFullName=(fileName||(Math.round(Math.random()*9999999999)+888888888))+'.'+fileExtension;if(typeof navigator.msSaveOrOpenBlob!=='undefined'){return navigator.msSaveOrOpenBlob(file,fileFullName)}else if(typeof navigator.msSaveBlob!=='undefined'){return navigator.msSaveBlob(file,fileFullName)}var hyperlink=document.createElement('a');hyperlink.href=URL.createObjectURL(file);hyperlink.target='_blank';hyperlink.download=fileFullName;if(!!navigator.mozGetUserMedia){hyperlink.onclick=function(){(document.body||document.documentElement).removeChild(hyperlink)};(document.body||document.documentElement).appendChild(hyperlink)}var evt=new MouseEvent('click',{view:window,bubbles:true,cancelable:true});hyperlink.dispatchEvent(evt);if(!navigator.mozGetUserMedia){URL.revokeObjectURL(hyperlink.href)}}var Storage={};if(typeof AudioContext!=='undefined'){Storage.AudioContext=AudioContext}else if(typeof webkitAudioContext!=='undefined'){Storage.AudioContext=webkitAudioContext}if(typeof RecordRTC!=='undefined'){RecordRTC.Storage=Storage}function isMediaRecorderCompatible(){var isOpera=!!window.opera||navigator.userAgent.indexOf(' OPR/')>=0;var isChrome=!!window.chrome&&!isOpera;var isFirefox=typeof window.InstallTrigger!=='undefined';if(isFirefox){return true}var nVer=navigator.appVersion;var nAgt=navigator.userAgent;var fullVersion=''+parseFloat(navigator.appVersion);var majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if(isChrome||isOpera){verOffset=nAgt.indexOf('Chrome');fullVersion=nAgt.substring(verOffset+7)}if((ix=fullVersion.indexOf(';'))!==-1){fullVersion=fullVersion.substring(0,ix)}if((ix=fullVersion.indexOf(' '))!==-1){fullVersion=fullVersion.substring(0,ix)}majorVersion=parseInt(''+fullVersion,10);if(isNaN(majorVersion)){fullVersion=''+parseFloat(navigator.appVersion);majorVersion=parseInt(navigator.appVersion,10)}return majorVersion>=49}function MediaStreamRecorder(mediaStream,config){var self=this;config=config||{mimeType:'video/webm'};if(config.type==='audio'){if(mediaStream.getVideoTracks().length&&mediaStream.getAudioTracks().length){var stream;if(!!navigator.mozGetUserMedia){stream=new MediaStream();stream.addTrack(mediaStream.getAudioTracks()[0])}else{stream=new MediaStream(mediaStream.getAudioTracks())}mediaStream=stream}if(!config.mimeType||config.mimeType.indexOf('audio')===-1){config.mimeType=isChrome?'audio/webm':'audio/ogg'}}this.record=function(){self.blob=null;var recorderHints=config;if(!config.disableLogs){console.log('Passing following config over MediaRecorder API.',recorderHints)}if(mediaRecorder){mediaRecorder=null}if(isChrome&&!isMediaRecorderCompatible()){recorderHints='video/vp8'}mediaRecorder=new MediaRecorder(mediaStream,recorderHints);if('canRecordMimeType'in mediaRecorder&&mediaRecorder.canRecordMimeType(config.mimeType)===false){if(!config.disableLogs){console.warn('MediaRecorder API seems unable to record mimeType:',config.mimeType)}}mediaRecorder.ignoreMutedMedia=config.ignoreMutedMedia||false;mediaRecorder.ondataavailable=function(e){if(self.dontFireOnDataAvailableEvent){return}if(!e.data||!e.data.size||e.data.size<100||self.blob){return}self.blob=config.getNativeBlob?e.data:new Blob([e.data],{type:config.mimeType||'video/webm'});if(self.recordingCallback){self.recordingCallback(self.blob);self.recordingCallback=null}};mediaRecorder.onerror=function(error){if(!config.disableLogs){if(error.name==='InvalidState'){console.error('The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.')}else if(error.name==='OutOfMemory'){console.error('The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.')}else if(error.name==='IllegalStreamModification'){console.error('A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.')}else if(error.name==='OtherRecordingError'){console.error('Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.')}else if(error.name==='GenericError'){console.error('The UA cannot provide the codec or recording option that has been requested.',error)}else{console.error('MediaRecorder Error',error)}}if(mediaRecorder.state!=='inactive'&&mediaRecorder.state!=='stopped'){mediaRecorder.stop()}};mediaRecorder.start(3.6e+6);if(config.onAudioProcessStarted){config.onAudioProcessStarted()}if(config.initCallback){config.initCallback()}};this.stop=function(callback){if(!mediaRecorder){return}this.recordingCallback=callback||function(){};if(mediaRecorder.state==='recording'){mediaRecorder.requestData();mediaRecorder.stop()}};this.pause=function(){if(!mediaRecorder){return}if(mediaRecorder.state==='recording'){mediaRecorder.pause()}};this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=false;var disableLogs=config.disableLogs;config.disableLogs=true;this.record();config.disableLogs=disableLogs;return}if(!mediaRecorder){return}if(mediaRecorder.state==='paused'){mediaRecorder.resume()}};this.clearRecordedData=function(){if(!mediaRecorder){return}this.pause();this.dontFireOnDataAvailableEvent=true;this.stop()};var mediaRecorder;function isMediaStreamActive(){if('active'in mediaStream){if(!mediaStream.active){return false}}else if('ended'in mediaStream){if(mediaStream.ended){return false}}return true}var self=this;(function looper(){if(!mediaRecorder){return}if(isMediaStreamActive()===false){if(!config.disableLogs){console.log('MediaStream seems stopped.')}self.stop();return}setTimeout(looper,1000)})()}if(typeof RecordRTC!=='undefined'){RecordRTC.MediaStreamRecorder=MediaStreamRecorder}function StereoAudioRecorder(mediaStream,config){if(!mediaStream.getAudioTracks().length){throw'Your stream has no audio tracks.'}config=config||{};var self=this;var leftchannel=[];var rightchannel=[];var recording=false;var recordingLength=0;var jsAudioNode;var numberOfAudioChannels=2;if(config.leftChannel===true){numberOfAudioChannels=1}if(config.numberOfAudioChannels===1){numberOfAudioChannels=1}if(!config.disableLogs){console.debug('StereoAudioRecorder is set to record number of channels: ',numberOfAudioChannels)}function isMediaStreamActive(){if('active'in mediaStream){if(!mediaStream.active){return false}}else if('ended'in mediaStream){if(mediaStream.ended){return false}}return true}this.record=function(){if(isMediaStreamActive()===false){throw'Please make sure MediaStream is active.'}leftchannel.length=rightchannel.length=0;recordingLength=0;if(audioInput){audioInput.connect(jsAudioNode)}isAudioProcessStarted=isPaused=false;recording=true};function mergeLeftRightBuffers(config,callback){function mergeAudioBuffers(config,cb){var numberOfAudioChannels=config.numberOfAudioChannels;var leftBuffers=config.leftBuffers.slice(0);var rightBuffers=config.rightBuffers.slice(0);var sampleRate=config.sampleRate;var internalInterleavedLength=config.internalInterleavedLength;if(numberOfAudioChannels===2){leftBuffers=mergeBuffers(leftBuffers,internalInterleavedLength);rightBuffers=mergeBuffers(rightBuffers,internalInterleavedLength)}if(numberOfAudioChannels===1){leftBuffers=mergeBuffers(leftBuffers,internalInterleavedLength)}function mergeBuffers(channelBuffer,rLength){var result=new Float64Array(rLength);var offset=0;var lng=channelBuffer.length;for(var i=0;i<lng;i++){var buffer=channelBuffer[i];result.set(buffer,offset);offset+=buffer.length}return result}function interleave(leftChannel,rightChannel){var length=leftChannel.length+rightChannel.length;var result=new Float64Array(length);var inputIndex=0;for(var index=0;index<length;){result[index++]=leftChannel[inputIndex];result[index++]=rightChannel[inputIndex];inputIndex++}return result}function writeUTFBytes(view,offset,string){var lng=string.length;for(var i=0;i<lng;i++){view.setUint8(offset+i,string.charCodeAt(i))}}var interleaved;if(numberOfAudioChannels===2){interleaved=interleave(leftBuffers,rightBuffers)}if(numberOfAudioChannels===1){interleaved=leftBuffers}var interleavedLength=interleaved.length;var resultingBufferLength=44+interleavedLength*2;var buffer=new ArrayBuffer(resultingBufferLength);var view=new DataView(buffer);writeUTFBytes(view,0,'RIFF');view.setUint32(4,44+interleavedLength*2,true);writeUTFBytes(view,8,'WAVE');writeUTFBytes(view,12,'fmt ');view.setUint32(16,16,true);view.setUint16(20,1,true);view.setUint16(22,numberOfAudioChannels,true);view.setUint32(24,sampleRate,true);view.setUint32(28,sampleRate*2,true);view.setUint16(32,numberOfAudioChannels*2,true);view.setUint16(34,16,true);writeUTFBytes(view,36,'data');view.setUint32(40,interleavedLength*2,true);var lng=interleavedLength;var index=44;var volume=1;for(var i=0;i<lng;i++){view.setInt16(index,interleaved[i]*(0x7FFF*volume),true);index+=2}if(cb){return cb({buffer:buffer,view:view})}postMessage({buffer:buffer,view:view})}if(!isChrome){mergeAudioBuffers(config,function(data){callback(data.buffer,data.view)});return}var webWorker=processInWebWorker(mergeAudioBuffers);webWorker.onmessage=function(event){callback(event.data.buffer,event.data.view);URL.revokeObjectURL(webWorker.workerURL)};webWorker.postMessage(config)}function processInWebWorker(_function){var workerURL=URL.createObjectURL(new Blob([_function.toString(),';this.onmessage =  function (e) {'+_function.name+'(e.data);}'],{type:'application/javascript'}));var worker=new Worker(workerURL);worker.workerURL=workerURL;return worker}this.stop=function(callback){recording=false;mergeLeftRightBuffers({sampleRate:sampleRate,numberOfAudioChannels:numberOfAudioChannels,internalInterleavedLength:recordingLength,leftBuffers:leftchannel,rightBuffers:numberOfAudioChannels===1?[]:rightchannel},function(buffer,view){self.blob=new Blob([view],{type:'audio/wav'});self.buffer=new ArrayBuffer(view.buffer.byteLength);self.view=view;self.sampleRate=sampleRate;self.bufferSize=bufferSize;self.length=recordingLength;if(callback){callback()}isAudioProcessStarted=false})};if(!Storage.AudioContextConstructor){Storage.AudioContextConstructor=new Storage.AudioContext()}var context=Storage.AudioContextConstructor;var audioInput=context.createMediaStreamSource(mediaStream);var legalBufferValues=[0,256,512,1024,2048,4096,8192,16384];var bufferSize=typeof config.bufferSize==='undefined'?4096:config.bufferSize;if(legalBufferValues.indexOf(bufferSize)===-1){if(!config.disableLogs){console.warn('Legal values for buffer-size are '+JSON.stringify(legalBufferValues,null,'\t'))}}if(context.createJavaScriptNode){jsAudioNode=context.createJavaScriptNode(bufferSize,numberOfAudioChannels,numberOfAudioChannels)}else if(context.createScriptProcessor){jsAudioNode=context.createScriptProcessor(bufferSize,numberOfAudioChannels,numberOfAudioChannels)}else{throw'WebAudio API has no support on this browser.'}audioInput.connect(jsAudioNode);if(!config.bufferSize){bufferSize=jsAudioNode.bufferSize}var sampleRate=typeof config.sampleRate!=='undefined'?config.sampleRate:context.sampleRate||44100;if(sampleRate<22050||sampleRate>96000){if(!config.disableLogs){console.warn('sample-rate must be under range 22050 and 96000.')}}if(!config.disableLogs){console.log('sample-rate',sampleRate);console.log('buffer-size',bufferSize)}var isPaused=false;this.pause=function(){isPaused=true};this.resume=function(){if(isMediaStreamActive()===false){throw'Please make sure MediaStream is active.'}if(!recording){if(!config.disableLogs){console.info('Seems recording has been restarted.')}this.record();return}isPaused=false};this.clearRecordedData=function(){this.pause();leftchannel.length=rightchannel.length=0;recordingLength=0};var isAudioProcessStarted=false;function onAudioProcessDataAvailable(e){if(isPaused){return}if(isMediaStreamActive()===false){if(!config.disableLogs){console.log('MediaStream seems stopped.')}jsAudioNode.disconnect();recording=false}if(!recording){audioInput.disconnect();return}if(!isAudioProcessStarted){isAudioProcessStarted=true;if(config.onAudioProcessStarted){config.onAudioProcessStarted()}if(config.initCallback){config.initCallback()}}var left=e.inputBuffer.getChannelData(0);leftchannel.push(new Float32Array(left));if(numberOfAudioChannels===2){var right=e.inputBuffer.getChannelData(1);rightchannel.push(new Float32Array(right))}recordingLength+=bufferSize}jsAudioNode.onaudioprocess=onAudioProcessDataAvailable;jsAudioNode.connect(context.destination)}if(typeof RecordRTC!=='undefined'){RecordRTC.StereoAudioRecorder=StereoAudioRecorder}function CanvasRecorder(htmlElement,config){if(typeof html2canvas==='undefined'&&htmlElement.nodeName.toLowerCase()!=='canvas'){throw'Please link: //cdn.webrtc-experiment.com/screenshot.js'}config=config||{};if(!config.frameInterval){config.frameInterval=10}var isCanvasSupportsStreamCapturing=false;['captureStream','mozCaptureStream','webkitCaptureStream'].forEach(function(item){if(item in document.createElement('canvas')){isCanvasSupportsStreamCapturing=true}});if(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia){isCanvasSupportsStreamCapturing=false}var globalCanvas,globalContext,mediaStreamRecorder;if(isCanvasSupportsStreamCapturing){if(!config.disableLogs){console.debug('Your browser supports both MediRecorder API and canvas.captureStream!')}globalCanvas=document.createElement('canvas');globalCanvas.width=htmlElement.clientWidth||window.innerWidth;globalCanvas.height=htmlElement.clientHeight||window.innerHeight;globalCanvas.style='top: -9999999; left: -99999999; visibility:hidden; position:absoluted; display: none;';(document.body||document.documentElement).appendChild(globalCanvas);globalContext=globalCanvas.getContext('2d')}else if(!!navigator.mozGetUserMedia){if(!config.disableLogs){alert('Canvas recording is NOT supported in Firefox.')}}var isRecording;this.record=function(){isRecording=true;if(isCanvasSupportsStreamCapturing){var canvasMediaStream;if('captureStream'in globalCanvas){canvasMediaStream=globalCanvas.captureStream(25)}else if('mozCaptureStream'in globalCanvas){canvasMediaStream=globalCanvas.captureStream(25)}else if('webkitCaptureStream'in globalCanvas){canvasMediaStream=globalCanvas.captureStream(25)}try{var mdStream=new MediaStream();mdStream.addTrack(canvasMediaStream.getVideoTracks()[0]);canvasMediaStream=mdStream}catch(e){}if(!canvasMediaStream){throw'captureStream API are NOT available.'}mediaStreamRecorder=new MediaStreamRecorder(canvasMediaStream,{mimeType:'video/webm'});mediaStreamRecorder.record()}else{whammy.frames=[];lastTime=new Date().getTime();drawCanvasFrame()}if(config.initCallback){config.initCallback()}};this.getWebPImages=function(callback){if(htmlElement.nodeName.toLowerCase()!=='canvas'){callback();return}var framesLength=whammy.frames.length;whammy.frames.forEach(function(frame,idx){var framesRemaining=framesLength-idx;document.title=framesRemaining+'/'+framesLength+' frames remaining';if(config.onEncodingCallback){config.onEncodingCallback(framesRemaining,framesLength)}var webp=frame.image.toDataURL('image/webp',1);whammy.frames[idx].image=webp});document.title='Generating WebM';callback()};this.stop=function(callback){isRecording=false;var that=this;if(isCanvasSupportsStreamCapturing&&mediaStreamRecorder){var slef=this;mediaStreamRecorder.stop(function(){for(var prop in mediaStreamRecorder){self[prop]=mediaStreamRecorder[prop]}if(callback){callback(that.blob)}});return}this.getWebPImages(function(){whammy.compile(function(blob){document.title='Recording finished!';that.blob=blob;if(that.blob.forEach){that.blob=new Blob([],{type:'video/webm'})}if(callback){callback(that.blob)}whammy.frames=[]})})};var isPausedRecording=false;this.pause=function(){isPausedRecording=true};this.resume=function(){isPausedRecording=false;if(!isRecording){this.record()}};this.clearRecordedData=function(){this.pause();whammy.frames=[]};function cloneCanvas(){var newCanvas=document.createElement('canvas');var context=newCanvas.getContext('2d');newCanvas.width=htmlElement.width;newCanvas.height=htmlElement.height;context.drawImage(htmlElement,0,0);return newCanvas}function drawCanvasFrame(){if(isPausedRecording){lastTime=new Date().getTime();return setTimeout(drawCanvasFrame,500)}if(htmlElement.nodeName.toLowerCase()==='canvas'){var duration=new Date().getTime()-lastTime;lastTime=new Date().getTime();whammy.frames.push({image:cloneCanvas(),duration:duration});if(isRecording){setTimeout(drawCanvasFrame,config.frameInterval)}return}html2canvas(htmlElement,{grabMouse:typeof config.showMousePointer==='undefined'||config.showMousePointer,onrendered:function(canvas){var duration=new Date().getTime()-lastTime;if(!duration){return setTimeout(drawCanvasFrame,config.frameInterval)}lastTime=new Date().getTime();whammy.frames.push({image:canvas.toDataURL('image/webp',1),duration:duration});if(isRecording){setTimeout(drawCanvasFrame,config.frameInterval)}}})}var lastTime=new Date().getTime();var whammy=new Whammy.Video(100)}if(typeof RecordRTC!=='undefined'){RecordRTC.CanvasRecorder=CanvasRecorder}function WhammyRecorder(mediaStream,config){config=config||{};if(!config.frameInterval){config.frameInterval=10}if(!config.disableLogs){console.log('Using frames-interval:',config.frameInterval)}this.record=function(){if(!config.width){config.width=320}if(!config.height){config.height=240}if(!config.video){config.video={width:config.width,height:config.height}}if(!config.canvas){config.canvas={width:config.width,height:config.height}}canvas.width=config.canvas.width;canvas.height=config.canvas.height;context=canvas.getContext('2d');if(config.video&&config.video instanceof HTMLVideoElement){video=config.video.cloneNode();if(config.initCallback){config.initCallback()}}else{video=document.createElement('video');if(typeof video.srcObject!=='undefined'){video.srcObject=mediaStream}else{video.src=URL.createObjectURL(mediaStream)}video.onloadedmetadata=function(){if(config.initCallback){config.initCallback()}};video.width=config.video.width;video.height=config.video.height}video.muted=true;video.play();lastTime=new Date().getTime();whammy=new Whammy.Video();if(!config.disableLogs){console.log('canvas resolutions',canvas.width,'*',canvas.height);console.log('video width/height',video.width||canvas.width,'*',video.height||canvas.height)}drawFrames(config.frameInterval)};function drawFrames(frameInterval){frameInterval=typeof frameInterval!=='undefined'?frameInterval:10;var duration=new Date().getTime()-lastTime;if(!duration){return setTimeout(drawFrames,frameInterval,frameInterval)}if(isPausedRecording){lastTime=new Date().getTime();return setTimeout(drawFrames,100)}lastTime=new Date().getTime();if(video.paused){video.play()}context.drawImage(video,0,0,canvas.width,canvas.height);whammy.frames.push({duration:duration,image:canvas.toDataURL('image/webp')});if(!isStopDrawing){setTimeout(drawFrames,frameInterval,frameInterval)}}function asyncLoop(o){var i=-1,length=o.length;var loop=function(){i++;if(i===length){o.callback();return}o.functionToLoop(loop,i)};loop()}function dropBlackFrames(_frames,_framesToCheck,_pixTolerance,_frameTolerance,callback){var localCanvas=document.createElement('canvas');localCanvas.width=canvas.width;localCanvas.height=canvas.height;var context2d=localCanvas.getContext('2d');var resultFrames=[];var checkUntilNotBlack=_framesToCheck===-1;var endCheckFrame=(_framesToCheck&&_framesToCheck>0&&_framesToCheck<=_frames.length)?_framesToCheck:_frames.length;var sampleColor={r:0,g:0,b:0};var maxColorDifference=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2));var pixTolerance=_pixTolerance&&_pixTolerance>=0&&_pixTolerance<=1?_pixTolerance:0;var frameTolerance=_frameTolerance&&_frameTolerance>=0&&_frameTolerance<=1?_frameTolerance:0;var doNotCheckNext=false;asyncLoop({length:endCheckFrame,functionToLoop:function(loop,f){var matchPixCount,endPixCheck,maxPixCount;var finishImage=function(){if(!doNotCheckNext&&maxPixCount-matchPixCount<=maxPixCount*frameTolerance){}else{if(checkUntilNotBlack){doNotCheckNext=true}resultFrames.push(_frames[f])}loop()};if(!doNotCheckNext){var image=new Image();image.onload=function(){context2d.drawImage(image,0,0,canvas.width,canvas.height);var imageData=context2d.getImageData(0,0,canvas.width,canvas.height);matchPixCount=0;endPixCheck=imageData.data.length;maxPixCount=imageData.data.length/4;for(var pix=0;pix<endPixCheck;pix+=4){var currentColor={r:imageData.data[pix],g:imageData.data[pix+1],b:imageData.data[pix+2]};var colorDifference=Math.sqrt(Math.pow(currentColor.r-sampleColor.r,2)+Math.pow(currentColor.g-sampleColor.g,2)+Math.pow(currentColor.b-sampleColor.b,2));if(colorDifference<=maxColorDifference*pixTolerance){matchPixCount++}}finishImage()};image.src=_frames[f].image}else{finishImage()}},callback:function(){resultFrames=resultFrames.concat(_frames.slice(endCheckFrame));if(resultFrames.length<=0){resultFrames.push(_frames[_frames.length-1])}callback(resultFrames)}})}var isStopDrawing=false;this.stop=function(callback){isStopDrawing=true;var _this=this;setTimeout(function(){dropBlackFrames(whammy.frames,-1,null,null,function(frames){whammy.frames=frames;if(config.advertisement&&config.advertisement.length){whammy.frames=config.advertisement.concat(whammy.frames)}whammy.compile(function(blob){_this.blob=blob;if(_this.blob.forEach){_this.blob=new Blob([],{type:'video/webm'})}if(callback){callback(_this.blob)}})})},10)};var isPausedRecording=false;this.pause=function(){isPausedRecording=true};this.resume=function(){isPausedRecording=false;if(isStopDrawing){this.record()}};this.clearRecordedData=function(){this.pause();whammy.frames=[]};var canvas=document.createElement('canvas');var context=canvas.getContext('2d');var video;var lastTime;var whammy}if(typeof RecordRTC!=='undefined'){RecordRTC.WhammyRecorder=WhammyRecorder}var Whammy=(function(){function WhammyVideo(duration){this.frames=[];this.duration=duration||1;this.quality=0.8}WhammyVideo.prototype.add=function(frame,duration){if('canvas'in frame){frame=frame.canvas}if('toDataURL'in frame){frame=frame.toDataURL('image/webp',this.quality)}if(!(/^data:image\/webp;base64,/ig).test(frame)){throw'Input must be formatted properly as a base64 encoded DataURI of type image/webp'}this.frames.push({image:frame,duration:duration||this.duration})};function processInWebWorker(_function){var blob=URL.createObjectURL(new Blob([_function.toString(),'this.onmessage =  function (e) {'+_function.name+'(e.data);}'],{type:'application/javascript'}));var worker=new Worker(blob);URL.revokeObjectURL(blob);return worker}function whammyInWebWorker(frames){function ArrayToWebM(frames){var info=checkFrames(frames);if(!info){return[]}var clusterMaxDuration=30000;var EBML=[{'id':0x1a45dfa3,'data':[{'data':1,'id':0x4286},{'data':1,'id':0x42f7},{'data':4,'id':0x42f2},{'data':8,'id':0x42f3},{'data':'webm','id':0x4282},{'data':2,'id':0x4287},{'data':2,'id':0x4285}]},{'id':0x18538067,'data':[{'id':0x1549a966,'data':[{'data':1e6,'id':0x2ad7b1},{'data':'whammy','id':0x4d80},{'data':'whammy','id':0x5741},{'data':doubleToString(info.duration),'id':0x4489}]},{'id':0x1654ae6b,'data':[{'id':0xae,'data':[{'data':1,'id':0xd7},{'data':1,'id':0x73c5},{'data':0,'id':0x9c},{'data':'und','id':0x22b59c},{'data':'V_VP8','id':0x86},{'data':'VP8','id':0x258688},{'data':1,'id':0x83},{'id':0xe0,'data':[{'data':info.width,'id':0xb0},{'data':info.height,'id':0xba}]}]}]}]}];var frameNumber=0;var clusterTimecode=0;while(frameNumber<frames.length){var clusterFrames=[];var clusterDuration=0;do{clusterFrames.push(frames[frameNumber]);clusterDuration+=frames[frameNumber].duration;frameNumber++}while(frameNumber<frames.length&&clusterDuration<clusterMaxDuration);var clusterCounter=0;var cluster={'id':0x1f43b675,'data':getClusterData(clusterTimecode,clusterCounter,clusterFrames)};EBML[1].data.push(cluster);clusterTimecode+=clusterDuration}return generateEBML(EBML)}function getClusterData(clusterTimecode,clusterCounter,clusterFrames){return[{'data':clusterTimecode,'id':0xe7}].concat(clusterFrames.map(function(webp){var block=makeSimpleBlock({discardable:0,frame:webp.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(clusterCounter)});clusterCounter+=webp.duration;return{data:block,id:0xa3}}))}function checkFrames(frames){if(!frames[0]){postMessage({error:'Something went wrong. Maybe WebP format is not supported in the current browser.'});return}var width=frames[0].width,height=frames[0].height,duration=frames[0].duration;for(var i=1;i<frames.length;i++){duration+=frames[i].duration}return{duration:duration,width:width,height:height}}function numToBuffer(num){var parts=[];while(num>0){parts.push(num&0xff);num=num>>8}return new Uint8Array(parts.reverse())}function strToBuffer(str){return new Uint8Array(str.split('').map(function(e){return e.charCodeAt(0)}))}function bitsToBuffer(bits){var data=[];var pad=(bits.length%8)?(new Array(1+8-(bits.length%8))).join('0'):'';bits=pad+bits;for(var i=0;i<bits.length;i+=8){data.push(parseInt(bits.substr(i,8),2))}return new Uint8Array(data)}function generateEBML(json){var ebml=[];for(var i=0;i<json.length;i++){var data=json[i].data;if(typeof data==='object'){data=generateEBML(data)}if(typeof data==='number'){data=bitsToBuffer(data.toString(2))}if(typeof data==='string'){data=strToBuffer(data)}var len=data.size||data.byteLength||data.length;var zeroes=Math.ceil(Math.ceil(Math.log(len)/Math.log(2))/8);var sizeToString=len.toString(2);var padded=(new Array((zeroes*7+7+1)-sizeToString.length)).join('0')+sizeToString;var size=(new Array(zeroes)).join('0')+'1'+padded;ebml.push(numToBuffer(json[i].id));ebml.push(bitsToBuffer(size));ebml.push(data)}return new Blob(ebml,{type:'video/webm'})}function toBinStrOld(bits){var data='';var pad=(bits.length%8)?(new Array(1+8-(bits.length%8))).join('0'):'';bits=pad+bits;for(var i=0;i<bits.length;i+=8){data+=String.fromCharCode(parseInt(bits.substr(i,8),2))}return data}function makeSimpleBlock(data){var flags=0;if(data.keyframe){flags|=128}if(data.invisible){flags|=8}if(data.lacing){flags|=(data.lacing<<1)}if(data.discardable){flags|=1}if(data.trackNum>127){throw'TrackNumber > 127 not supported'}var out=[data.trackNum|0x80,data.timecode>>8,data.timecode&0xff,flags].map(function(e){return String.fromCharCode(e)}).join('')+data.frame;return out}function parseWebP(riff){var VP8=riff.RIFF[0].WEBP[0];var frameStart=VP8.indexOf('\x9d\x01\x2a');for(var i=0,c=[];i<4;i++){c[i]=VP8.charCodeAt(frameStart+3+i)}var width,height,tmp;tmp=(c[1]<<8)|c[0];width=tmp&0x3FFF;tmp=(c[3]<<8)|c[2];height=tmp&0x3FFF;return{width:width,height:height,data:VP8,riff:riff}}function getStrLength(string,offset){return parseInt(string.substr(offset+4,4).split('').map(function(i){var unpadded=i.charCodeAt(0).toString(2);return(new Array(8-unpadded.length+1)).join('0')+unpadded}).join(''),2)}function parseRIFF(string){var offset=0;var chunks={};while(offset<string.length){var id=string.substr(offset,4);var len=getStrLength(string,offset);var data=string.substr(offset+4+4,len);offset+=4+4+len;chunks[id]=chunks[id]||[];if(id==='RIFF'||id==='LIST'){chunks[id].push(parseRIFF(data))}else{chunks[id].push(data)}}return chunks}function doubleToString(num){return[].slice.call(new Uint8Array((new Float64Array([num])).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join('')}var webm=new ArrayToWebM(frames.map(function(frame){var webp=parseWebP(parseRIFF(atob(frame.image.slice(23))));webp.duration=frame.duration;return webp}));postMessage(webm)}WhammyVideo.prototype.compile=function(callback){var webWorker=processInWebWorker(whammyInWebWorker);webWorker.onmessage=function(event){if(event.data.error){console.error(event.data.error);return}callback(event.data)};webWorker.postMessage(this.frames)};return{Video:WhammyVideo}})();if(typeof RecordRTC!=='undefined'){RecordRTC.Whammy=Whammy}var DiskStorage={init:function(){var self=this;if(typeof indexedDB==='undefined'||typeof indexedDB.open==='undefined'){console.error('IndexedDB API are not available in this browser.');return}var dbVersion=1;var dbName=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,''),db;var request=indexedDB.open(dbName,dbVersion);function createObjectStore(dataBase){dataBase.createObjectStore(self.dataStoreName)}function putInDB(){var transaction=db.transaction([self.dataStoreName],'readwrite');if(self.videoBlob){transaction.objectStore(self.dataStoreName).put(self.videoBlob,'videoBlob')}if(self.gifBlob){transaction.objectStore(self.dataStoreName).put(self.gifBlob,'gifBlob')}if(self.audioBlob){transaction.objectStore(self.dataStoreName).put(self.audioBlob,'audioBlob')}function getFromStore(portionName){transaction.objectStore(self.dataStoreName).get(portionName).onsuccess=function(event){if(self.callback){self.callback(event.target.result,portionName)}}}getFromStore('audioBlob');getFromStore('videoBlob');getFromStore('gifBlob')}request.onerror=self.onError;request.onsuccess=function(){db=request.result;db.onerror=self.onError;if(db.setVersion){if(db.version!==dbVersion){var setVersion=db.setVersion(dbVersion);setVersion.onsuccess=function(){createObjectStore(db);putInDB()}}else{putInDB()}}else{putInDB()}};request.onupgradeneeded=function(event){createObjectStore(event.target.result)}},Fetch:function(callback){this.callback=callback;this.init();return this},Store:function(config){this.audioBlob=config.audioBlob;this.videoBlob=config.videoBlob;this.gifBlob=config.gifBlob;this.init();return this},onError:function(error){console.error(JSON.stringify(error,null,'\t'))},dataStoreName:'recordRTC',dbName:null};if(typeof RecordRTC!=='undefined'){RecordRTC.DiskStorage=DiskStorage}function GifRecorder(mediaStream,config){if(typeof GIFEncoder==='undefined'){throw'Please link: https://cdn.webrtc-experiment.com/gif-recorder.js'}config=config||{};var isHTMLObject=mediaStream instanceof CanvasRenderingContext2D||mediaStream instanceof HTMLCanvasElement;this.record=function(){if(!isHTMLObject){if(!config.width){config.width=video.offsetWidth||320}if(!this.height){config.height=video.offsetHeight||240}if(!config.video){config.video={width:config.width,height:config.height}}if(!config.canvas){config.canvas={width:config.width,height:config.height}}canvas.width=config.canvas.width;canvas.height=config.canvas.height;video.width=config.video.width;video.height=config.video.height}gifEncoder=new GIFEncoder();gifEncoder.setRepeat(0);gifEncoder.setDelay(config.frameRate||200);gifEncoder.setQuality(config.quality||10);gifEncoder.start();startTime=Date.now();var self=this;function drawVideoFrame(time){if(isPausedRecording){return setTimeout(function(){drawVideoFrame(time)},100)}lastAnimationFrame=requestAnimationFrame(drawVideoFrame);if(typeof lastFrameTime===undefined){lastFrameTime=time}if(time-lastFrameTime<90){return}if(!isHTMLObject&&video.paused){video.play()}if(!isHTMLObject){context.drawImage(video,0,0,canvas.width,canvas.height)}if(config.onGifPreview){config.onGifPreview(canvas.toDataURL('image/png'))}gifEncoder.addFrame(context);lastFrameTime=time}lastAnimationFrame=requestAnimationFrame(drawVideoFrame);if(config.initCallback){config.initCallback()}};this.stop=function(){if(lastAnimationFrame){cancelAnimationFrame(lastAnimationFrame)}endTime=Date.now();this.blob=new Blob([new Uint8Array(gifEncoder.stream().bin)],{type:'image/gif'});gifEncoder.stream().bin=[]};var isPausedRecording=false;this.pause=function(){isPausedRecording=true};this.resume=function(){isPausedRecording=false};this.clearRecordedData=function(){if(!gifEncoder){return}this.pause();gifEncoder.stream().bin=[]};var canvas=document.createElement('canvas');var context=canvas.getContext('2d');if(isHTMLObject){if(mediaStream instanceof CanvasRenderingContext2D){context=mediaStream;canvas=context.canvas}else if(mediaStream instanceof HTMLCanvasElement){context=mediaStream.getContext('2d');canvas=mediaStream}}if(!isHTMLObject){var video=document.createElement('video');video.muted=true;video.autoplay=true;if(typeof video.srcObject!=='undefined'){video.srcObject=mediaStream}else{video.src=URL.createObjectURL(mediaStream)}video.play()}var lastAnimationFrame=null;var startTime,endTime,lastFrameTime;var gifEncoder}if(typeof RecordRTC!=='undefined'){RecordRTC.GifRecorder=GifRecorder}